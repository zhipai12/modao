import{G as I,P as g}from"./api-BIrU0cY3.js";import{d as R,r as _,m as B,o as D,c as j,w as l,b as m,e as o,g as r,h as w,a as z,j as E,p as L,l as M,_ as Q}from"./index-H79NZkW1.js";const V=()=>I("/noProd/syncData/options"),F=u=>g("/noProd/syncData/showSql",u),H=u=>g("/noProd/syncData/exec",u),y=u=>(L("data-v-6fb54b1b"),u=u(),M(),u),J={class:"home"},K=y(()=>m("div",{class:"title"},"数据同步",-1)),W=y(()=>m("span",{style:{opacity:"0"}},"按钮",-1)),X=R({__name:"index",setup(u){const f=_(),e=_({from_env:void 0,to_env:"local",business:void 0,business_group:void 0,ids:"",skip_and_continue_when_conflict:void 0,show_sql:void 0}),k={style:{width:"110px"}},q=_(!1),b=_(),h=_(),p=_(),c={label:"cn_name",value:"val"},d=async(a,s)=>s?Promise.resolve():Promise.reject("请输入"),x={from_env:[{required:!0,validator:d,trigger:"change"}],to_env:[{required:!0,validator:d,trigger:"change"}],business:[{required:!0,validator:d,trigger:"change"}],business_group:[{required:!0,validator:d,trigger:"change"}],ids:[{required:!0,validator:d,trigger:"change"}]};async function S(){const{data:a}=await V();p.value=a.env.opts,b.value=a.sync_data_business.opts,h.value=a.sync_data_business_group.opts}async function C(){var i,n;const a={from_env:e.value.from_env,to_env:e.value.to_env,business:e.value.business,business_group:e.value.business_group,ids:(n=(i=e.value.ids)==null?void 0:i.toString())==null?void 0:n.split(",").map(Number),skip_and_continue_when_conflict:e.value.skip_and_continue_when_conflict},{data:s}=await F(a);e.value.show_sql=s.sql}async function P(){var s,i,n;await((s=f.value)==null?void 0:s.validate());const a={from_env:e.value.from_env,to_env:e.value.to_env,business:e.value.business,business_group:e.value.business_group,ids:(n=(i=e.value.ids)==null?void 0:i.toString())==null?void 0:n.split(",").map(Number),skip_and_continue_when_conflict:e.value.skip_and_continue_when_conflict};await H(a),z.success("操作成功")}let v;return B(()=>e.value,a=>{const s=a.business&&a.business_group&&a.from_env&&a.ids;v&&clearTimeout(v),s&&(v=setTimeout(()=>{C()},600))},{deep:!0}),D(()=>{S()}),(a,s)=>{const i=r("a-select"),n=r("a-form-item"),U=r("a-input"),N=r("a-textarea"),O=r("a-checkbox"),T=r("a-button"),A=r("a-form"),G=r("a-spin");return E(),j(G,{spinning:q.value},{default:l(()=>[m("div",J,[K,o(A,{"label-col":k,model:e.value,class:"form",ref_key:"formRef",ref:f,rules:x},{default:l(()=>[o(n,{label:"同步数据源库",name:"from_env"},{default:l(()=>[o(i,{value:e.value.from_env,"onUpdate:value":s[0]||(s[0]=t=>e.value.from_env=t),options:p.value,fieldNames:c,placeholder:"请选择",allowClear:"",style:{width:"50%"}},null,8,["value","options"])]),_:1}),o(n,{label:"同步目标库",name:"to_env"},{default:l(()=>[o(i,{disabled:"",value:e.value.to_env,"onUpdate:value":s[1]||(s[1]=t=>e.value.to_env=t),options:p.value,fieldNames:c,placeholder:"请选择",allowClear:"",style:{width:"50%"}},null,8,["value","options"])]),_:1}),o(n,{label:"业务",name:"business"},{default:l(()=>[o(i,{value:e.value.business,"onUpdate:value":s[2]||(s[2]=t=>e.value.business=t),options:b.value,placeholder:"请选择",allowClear:"",fieldNames:c,style:{width:"50%"}},null,8,["value","options"])]),_:1}),o(n,{label:"业务id类型",name:"business_group"},{default:l(()=>[o(i,{value:e.value.business_group,"onUpdate:value":s[3]||(s[3]=t=>e.value.business_group=t),options:h.value,placeholder:"请选择",allowClear:"",fieldNames:c,style:{width:"50%"}},null,8,["value","options"])]),_:1}),o(n,{label:"ids",name:"ids"},{default:l(()=>[o(U,{value:e.value.ids,"onUpdate:value":s[4]||(s[4]=t=>e.value.ids=t),placeholder:"请输入id，以逗号区分",allowClear:"",style:{width:"50%"}},null,8,["value"])]),_:1}),o(n,{label:"同步sql如下",name:"show_sql"},{default:l(()=>[o(N,{value:e.value.show_sql,"onUpdate:value":s[5]||(s[5]=t=>e.value.show_sql=t),readonly:"","auto-size":{minRows:5,maxRows:8},placeholder:"展示文本"},null,8,["value"])]),_:1}),o(n,{label:"执行",name:"skip_and_continue_when_conflict"},{default:l(()=>[o(O,{checked:e.value.skip_and_continue_when_conflict,"onUpdate:checked":s[6]||(s[6]=t=>e.value.skip_and_continue_when_conflict=t)},{default:l(()=>[w("数据冲突时跳过并继续往后执行")]),_:1},8,["checked"])]),_:1}),o(n,{colon:!1},{label:l(()=>[W]),default:l(()=>[o(T,{type:"primary",onClick:P},{default:l(()=>[w("同步")]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1},8,["spinning"])}}}),$=Q(X,[["__scopeId","data-v-6fb54b1b"]]);export{$ as default};
